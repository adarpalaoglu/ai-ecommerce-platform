---
Status: Approved
Epic: 3
Story: 2
Title: Frontend "Buy Now" and Order History
---

### Story

**As a** user,
**I want** to be able to click a "Buy Now" button to place my order and then see that order in my account history,
**so that** I have a record of my purchase.

### Acceptance Criteria

1.  A "Buy Now" button is present on the shopping cart page.
2.  Clicking the "Buy Now" button calls the `POST /api/orders` endpoint.
3.  After a successful order, the user is redirected to a simple "Thank You" or order confirmation page.
4.  The user's account section has an "Order History" page that lists all their past orders, fetched from a `GET /api/orders` endpoint.
5.  Each order in the history displays the order date, total amount, and current status.

### Dev Notes

#### Previous Story Insights

Story 3.1 implemented the backend order creation (`POST /api/orders`), which this story will consume.

#### Frontend Architecture

-   Component Organization: `apps/web/src/pages/cart/CartPage.tsx` for the "Buy Now" button, and `apps/web/src/pages/user/OrderHistoryPage.tsx` for order history. [Source: docs/architecture/frontend-architecture.md]
-   State Management: Use Zustand stores for managing cart state and order history. [Source: docs/architecture/frontend-architecture.md]
-   Routing: Implement routing for `/cart` and `/user/orders` (or similar). Protected routes should be used for order history. [Source: docs/architecture/frontend-architecture.md]
-   API Client: Use `apps/web/src/services/apiClient.ts` for API calls. [Source: docs/architecture/frontend-architecture.md]

#### API Specifications

-   `POST /api/orders`: To create an order from the cart. [Source: docs/prd/epic-3.md]
-   `GET /api/orders`: To fetch order history for the current user. [Source: docs/prd/epic-3.md]

#### Data Models

-   `Order` model: `id`, `userId`, `orderDate`, `totalAmount`, `status`, `shippingAddressId`, `createdAt`, `updatedAt`. [Source: docs/architecture/data-models.md]
-   `OrderItem` model: `id`, `orderId`, `productId`, `quantity`, `price`. [Source: docs/architecture/data-models.md]
-   `User` model: `id`, `email`, `passwordHash`, `firstName`, `lastName`, `createdAt`, `updatedAt`. [Source: docs/architecture/data-models.md]

#### File Locations

-   Frontend application code is in `apps/web/src/`. [Source: docs/architecture/unified-project-structure.md]
-   Pages in `apps/web/src/pages/`. [Source: docs/architecture/unified-project-structure.md]
-   Services in `apps/web/src/services/`. [Source: docs/architecture/unified-project-structure.md]
-   Shared types in `packages/shared/src/types/`. [Source: docs/architecture/coding-standards.md]

#### Testing Requirements

-   Frontend Testing: Jest, React Testing Library for unit and integration testing. [Source: docs/architecture/tech-stack.md]
-   Test Organization: Unit tests for components in `apps/web/src/components/` and integration tests for pages in `apps/web/src/pages/`. [Source: docs/architecture/testing-strategy.md]
-   E2E Testing: Cypress for end-to-end testing of the purchase flow. [Source: docs/architecture/tech-stack.md]
-   Test Data Requirements:
    -   Positive Cases: Successful order placement, displaying multiple orders in history.
    -   Edge Cases: Empty cart checkout attempt, no orders in history.
    -   Negative Cases: Failed order placement (e.g., insufficient stock), unauthorized access to order history.

#### Technical Constraints

-   Frontend Language: TypeScript 5.x [Source: docs/architecture/tech-stack.md]
-   Frontend Framework: React 18.x [Source: docs/architecture/tech-stack.md]
-   UI Component Library: Material-UI 5.x [Source: docs/architecture/tech-stack.md]
-   State Management: Zustand 4.x [Source: docs/architecture/tech-stack.md]
-   Type Sharing: Always define types in `packages/shared/src/types`. [Source: docs/architecture/coding-standards.md]
-   API Calls: Never make direct HTTP calls from components; use the service layer (`apps/web/src/services`). [Source: docs/architecture/coding-standards.md]
-   Error Handling: Standard error handling for API responses. [Source: docs/architecture/coding-standards.md]

### Tasks / Subtasks

1.  (AC: 1, 2, 3) Implement "Buy Now" functionality on the shopping cart page.
    *   [ ] Add a "Buy Now" button to `apps/web/src/pages/cart/CartPage.tsx`.
    *   [ ] Implement an `onClick` handler for the "Buy Now" button to call `POST /api/orders` via the frontend service layer.
    *   [ ] Handle successful order creation by redirecting the user to a confirmation page (e.g., `/order-confirmation`).
    *   [ ] Handle errors during order creation and display appropriate feedback to the user.
2.  (AC: 4, 5) Create "Order History" page in the user's account section.
    *   [ ] Create a new page component `apps/web/src/pages/user/OrderHistoryPage.tsx`.
    *   [ ] Implement logic to fetch order history using `GET /api/orders` via the frontend service layer.
    *   [ ] Display the list of orders, showing order date, total amount, and status for each.
    *   [ ] Add a link to the "Order History" page in the user's account navigation.
3.  Implement frontend service calls for orders.
    *   [ ] Create `apps/web/src/services/orderService.ts` to encapsulate API calls related to orders.
    *   [ ] Add `createOrder` (POST /api/orders) and `getOrders` (GET /api/orders) functions to `orderService.ts`.
4.  Define shared types for Order and OrderItem.
    *   [ ] Ensure `Order` and `OrderItem` interfaces are defined in `packages/shared/src/types/`.
5.  Write unit and integration tests for frontend order functionality.
    *   [ ] Write unit tests for the "Buy Now" button component and its interaction with the service layer.
    *   [ ] Write integration tests for the `CartPage` to verify the "Buy Now" flow.
    *   [ ] Write integration tests for the `OrderHistoryPage` to verify order display and fetching.
6.  Write E2E tests for the "Buy Now" and Order History flow.
    *   [ ] Create a Cypress test file to simulate a user adding items to cart, clicking "Buy Now", and then viewing their order history.

### Change Log

| Date | Version | Description | Author |
|---|---|---|---|
| 2025-08-08 | 1.0 | Initial draft based on Epic 3.2 and architecture documents | James (Dev Agent) |

### Dev Agent Record

#### Agent Model Used

#### Debug Log References

#### Completion Notes List

#### File List

#### QA Results

**Validation Report:**

**Quick Summary:**
- Story readiness: DRAFT (Not ready for implementation yet)
- Clarity score: 10/10 (Story content is clear)
- Major gaps identified: None (from a drafting perspective).

| Category | Status | Issues |
|---|---|---|
| 1. Requirements Met | FAIL | Story is in draft; no implementation yet. |
| 2. Coding Standards & Project Structure | N/A | No code implemented yet. |
| 3. Testing | FAIL | No tests implemented yet. |
| 4. Functionality & Verification | FAIL | No functionality implemented or verified yet. |
| 5. Story Administration | PARTIAL | Tasks are not marked complete as no implementation has occurred. |
| 6. Dependencies, Build & Configuration | N/A | No new dependencies or build changes yet. |
| 7. Documentation (If Applicable) | N/A | No code documentation yet. |

**Final Assessment:**

- **STOP**: The story is in draft mode and requires implementation.
- **Implementation Readiness Score**: 0/10 (Not ready for implementation by a Dev Agent until marked "Ready for Dev")
- **Confidence Level**: N/A (No implementation to assess confidence on)
